<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Calculadora GP ‚Äî Tema Escuro (Apenas Teclado)</title>
<style>
  /* CSS AJUSTADO */
  :root{
    /* Cores para Tema Escuro */
    --bg: #1e1e2d; /* Fundo principal */
    --card: #27293d; /* Fundo dos elementos/cards */
    --muted: #a0aec0; /* Texto secund√°rio */
    --text: #ffffff; /* Texto principal */
    --accent: #00a86b; /* Destaque prim√°rio (verde vibrante) */
    --accent-2: #6b46c1; /* Destaque secund√°rio (roxo) */
    --danger: #e35b5b; /* Perigo/Clear */
    --shadow: 0 4px 12px rgba(0,0,0,0.4);
    --glass: linear-gradient(180deg, rgba(39,41,61,0.95), rgba(45,47,70,0.95)); /* Fundo com leve transpar√™ncia */
  }

  *{box-sizing:border-box;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif}
  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg, var(--bg), #19192a);
    color:var(--text);
    padding:24px;
  }

  .app{
    width:100%;
    max-width:900px; /* Reduzindo max-width j√° que o keypad foi removido */
    background:var(--card);
    border-radius:12px;
    box-shadow:var(--shadow);
    display:grid;
    /* Ajustando o grid: Left (hist√≥rico) e Right (entrada/contas) ter√£o 1fr */
    grid-template-columns: 1fr 1fr;
    gap:18px;
    padding:18px;
    border: 1px solid rgba(255,255,255,0.05);
  }

  /* Header */
  .header{
    grid-column: 1 / -1;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:4px;
  }
  .title{font-weight:700; color:var(--text)}
  .subtitle{color:var(--muted); font-size:13px}

  /* Left: hist√≥rico */
  .left{
    padding:12px;
    border-radius:10px;
    background:var(--glass);
    border:1px solid rgba(255,255,255,0.06);
    /* Removendo estilos desnecess√°rios que eram para o keypad */
  }

  .history-wrap{
    display:flex;
    gap:12px;
  }

  /* Fazendo o hist√≥rico preencher todo o espa√ßo na coluna left */
  .history{
    flex:1;
    min-height:400px; /* Aumentando a altura m√≠nima */
    background:rgba(0,0,0,0.2);
    border-radius:8px;
    padding:12px;
    border:1px solid rgba(255,255,255,0.08);
    overflow:auto;
    box-shadow:0 2px 8px rgba(0,0,0,0.2);
  }
  .history h4{margin:0 0 8px 0; font-size:13px; color:var(--muted)}
  .hist-item{
    padding:8px;
    border-radius:6px;
    margin-bottom:8px;
    background:rgba(255,255,255,0.05);
    border:1px solid rgba(255,255,255,0.03);
    font-size:14px;
  }
  .hist-small{display:block;font-size:12px;color:var(--muted); margin-top:4px}

  /* Right: entrada e totais */
  .right{
    padding:12px;
    border-radius:10px;
    background:var(--glass);
    border:1px solid rgba(255,255,255,0.06);
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .input-area{
    display:flex;
    flex-direction:column;
    gap:8px;
  }

  .label-row{display:flex; justify-content:space-between; align-items:center}
  .label-row .hint{font-size:13px; color:var(--muted)}

  input#entrada{
    height:80px;
    font-size:32px;
    padding:12px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.1);
    background:rgba(0,0,0,0.3);
    color:var(--text);
    outline:none;
    text-align:right;
    box-shadow:inset 0 1px 3px rgba(0,0,0,0.4);
  }

  /* sections Dinheiro / Cr√©dito / D√©bito */
  .accounts{display:flex; flex-direction:column; gap:10px}
  .acc{
    display:grid;
    grid-template-columns: 68px 1fr;
    gap:10px;
    align-items:center;
    padding:10px;
    border-radius:8px;
    background: var(--card);
    border:1px solid rgba(255,255,255,0.05);
  }
  .acc .key-btn{
    height:40px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:6px;
    border:1px solid rgba(255,255,255,0.1);
    cursor:pointer;
    background:rgba(0,0,0,0.3);
    font-weight:700;
    color:var(--muted);
  }
  .acc .key-btn.active{
    background:linear-gradient(180deg,var(--accent), #008f5a);
    color:white;
    border:none;
  }
  .acc .tag{font-size:13px; color:var(--muted);}
  .acc .amount{font-size:24px; font-weight:700; margin-top:4px; color:var(--accent);}
  .acc .controls{display:flex; gap:8px; align-items:center; margin-top:6px}
  .small-btn{
    padding:6px 8px;
    border-radius:6px;
    border:1px solid rgba(255,255,255,0.1);
    background:rgba(0,0,0,0.3);
    cursor:pointer;
    font-size:13px;
    color:var(--muted);
  }
  .small-btn:hover{background:rgba(0,0,0,0.5);}

  .footer-row{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:6px}
  .muted-note{font-size:13px; color:var(--muted)}

  input[type="checkbox"]{
    accent-color: var(--accent);
  }

  /* responsivo */
  @media (max-width:800px){ /* Ajustando breakpoint para telas menores */
    .app{grid-template-columns:1fr; padding:12px}
  }
</style>
</head>
<body>
  <div class="app" id="app">
    <div class="header">
      <div>
        <div class="title">Calculadora GP ‚Äî Tema Escuro üåí</div>
        <div class="subtitle">Focada no Teclado: Enter = adicionar ‚Ä¢ F5/F6/F7 selecionam ‚Ä¢ Esc limpa</div>
      </div>
      <div class="subtitle">By LucasC. ‚Ä¢ Vers√£o 3.1</div>
    </div>

    <div class="left">
      <div class="history-wrap">
        <div class="history" id="history">
          <h4>Hist√≥rico</h4>
          <div id="histList"></div>
        </div>
      </div>

      <div style="display:flex; justify-content:space-between; align-items:center; margin-top:12px;">
        <div class="muted-note">Opera√ß√£o via teclado f√≠sico.</div>
        <div style="display:flex; gap:8px;">
          <button class="small-btn" id="clearHistBtn">Limpar hist√≥rico</button>
        </div>
      </div>
      </div>

    <div class="right">
      <div class="input-area">
        <div class="label-row">
          <div class="hint">Digite valor | Pressione Enter para adicionar ao tipo selecionado</div>
          <div class="hint">Use F5 (Dinheiro), F6 (Cr√©dito), F7 (D√©bito)</div>
        </div>

        <input id="entrada" placeholder="0,00" inputmode="decimal" />

        <div class="footer-row">
          <div style="display:flex; gap:8px;">
            <button class="small-btn" id="btnAdd">Adicionar (Enter)</button>
            <button class="small-btn" id="btnCalc">Calcular (sem adicionar)</button>
          </div>
          <div class="muted-note">Esc = limpar entrada ‚Ä¢ Backspace = apagar</div>
        </div>
      </div>

      <div class="accounts">
        <div class="acc" id="acc-din">
          <div>
            <div class="key-btn" id="btnF5">F5</div>
          </div>
          <div class="info">
            <div class="tag">Dinheiro</div>
            <div class="amount" id="amtDin">R$ 0,00</div>
            <div class="controls"><input type="checkbox" id="chkDin" /> <label for="chkDin" style="color:var(--muted); font-size:13px; margin-left:6px">Selecionar</label>
              <button class="small-btn" data-clear="din">Limpar</button>
            </div>
          </div>
        </div>

        <div class="acc" id="acc-cred">
          <div>
            <div class="key-btn" id="btnF6">F6</div>
          </div>
          <div class="info">
            <div class="tag">Cr√©dito</div>
            <div class="amount" id="amtCred">R$ 0,00</div>
            <div class="controls"><input type="checkbox" id="chkCred" /> <label for="chkCred" style="color:var(--muted); font-size:13px; margin-left:6px">Selecionar</label>
              <button class="small-btn" data-clear="cred">Limpar</button>
            </div>
          </div>
        </div>

        <div class="acc" id="acc-deb">
          <div>
            <div class="key-btn" id="btnF7">F7</div>
          </div>
          <div class="info">
            <div class="tag">D√©bito</div>
            <div class="amount" id="amtDeb">R$ 0,00</div>
            <div class="controls"><input type="checkbox" id="chkDeb" /> <label for="chkDeb" style="color:var(--muted); font-size:13px; margin-left:6px">Selecionar</label>
              <button class="small-btn" data-clear="deb">Limpar</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
/* ======= L√ìGICA (AJUSTADA: Removendo eventos do keypad virtual) ======= */
const entrada = document.getElementById('entrada');
const histList = document.getElementById('histList');
const clearHistBtn = document.getElementById('clearHistBtn');

const amtDin = document.getElementById('amtDin');
const amtCred = document.getElementById('amtCred');
const amtDeb = document.getElementById('amtDeb');

const chkDin = document.getElementById('chkDin');
const chkCred = document.getElementById('chkCred');
const chkDeb = document.getElementById('chkDeb');

const btnF5 = document.getElementById('btnF5');
const btnF6 = document.getElementById('btnF6');
const btnF7 = document.getElementById('btnF7');

let totals = { din: 0, cred: 0, deb: 0 };
let history = [];
let selected = null; // 'din' | 'cred' | 'deb' | null

/* util: formata n√∫mero para moeda pt-BR */
function formatMoney(n){
  if (isNaN(n) || n === null) n = 0;
  return n.toLocaleString('pt-BR', { style:'currency', currency:'BRL' });
}

/* atualiza UI dos totais e sele√ß√£o */
function updateTotalsUI(){
  amtDin.textContent = formatMoney(totals.din);
  amtCred.textContent = formatMoney(totals.cred);
  amtDeb.textContent = formatMoney(totals.deb);

  // checkboxes reflect selected
  chkDin.checked = selected === 'din';
  chkCred.checked = selected === 'cred';
  chkDeb.checked = selected === 'deb';

  btnF5.classList.toggle('active', selected === 'din');
  btnF6.classList.toggle('active', selected === 'cred');
  btnF7.classList.toggle('active', selected === 'deb');
}

/* adiciona item no hist√≥rico */
function pushHistory(obj){
  history.unshift(obj);
  renderHistory();
}

/* render hist√≥rico */
function renderHistory(){
  histList.innerHTML = '';
  if(history.length === 0){
    histList.innerHTML = '<div class="hist-item">Nenhuma opera√ß√£o ainda.</div>';
    return;
  }
  history.forEach(it => {
    const div = document.createElement('div');
    div.className = 'hist-item';
    const label = it.typeLabel.toUpperCase();
    div.innerHTML = `<strong>[${label.charAt(0)}]</strong> ${it.expr}<div class="hist-small">${it.note}</div>`;
    histList.appendChild(div);
  });
}

/* processa express√£o (entrada do usu√°rio), retorna n√∫mero */
function evalExpression(expr){
  if(!expr) return 0;
  // normaliza: v√≠rgula -> ponto, troca √ó √∑ se existirem
  expr = expr.replace(/√ó/g,'*').replace(/√∑/g,'/').replace(/,/g,'.').trim();

  // permitir apenas caracteres seguros: d√≠gitos, operadores, par√™nteses, ponto, espa√ßo e %
  if(!/^[0-9+\-*/().%\s]*$/.test(expr)){
    throw new Error('Express√£o cont√©m caracteres inv√°lidos');
  }

  // trata porcentagem simples: converte "50%" em "(50/100)"
  expr = expr.replace(/(\d+(\.\d+)?)%/g, '($1/100)');

  // eval com Function para evitar acesso a escopo local
  // NOTA: mantemos valida√ß√£o acima; em apps reais usar parser matem√°tico.
  const fn = new Function('return ' + expr);
  const value = fn();
  if(typeof value !== 'number' || !isFinite(value)) throw new Error('Resultado inv√°lido');
  return value;
}

/* quando o usu√°rio quer "adicionar" ao tipo selecionado (Enter ou bot√£o) */
function addToSelected(){
  if(!selected){
    alert('Selecione um tipo (F5 Dinheiro / F6 Cr√©dito / F7 D√©bito) antes de adicionar.');
    return;
  }
  const raw = entrada.value.trim();
  if(!raw){
    alert('Digite um valor ou express√£o antes de adicionar.');
    return;
  }
  let val;
  try{
    val = evalExpression(raw);
  }catch(err){
    alert('Erro ao calcular: ' + err.message);
    return;
  }
  // soma no tipo
  if(selected === 'din') totals.din += val;
  if(selected === 'cred') totals.cred += val;
  if(selected === 'deb') totals.deb += val;

  // registra hist√≥rico
  const label = selected === 'din' ? 'Dinheiro' : selected === 'cred' ? 'Cr√©dito' : 'D√©bito';
  pushHistory({
    typeLabel: label,
    expr: `${raw} = ${formatMoney(val)}`,
    note: `Adicionado ao ${label} ‚Üí Total agora: ${formatMoney(selected === 'din'?totals.din: selected==='cred'?totals.cred:totals.deb)}`
  });

  entrada.value = '';
  updateTotalsUI();
}

/* apenas calcular e mostrar num aviso (sem adicionar) */
function calcOnly(){
  const raw = entrada.value.trim();
  if(!raw){ alert('Digite algo para calcular.'); return; }
  try{
    const v = evalExpression(raw);
    alert(`Resultado: ${formatMoney(v)}`);
  }catch(err){
    alert('Erro: ' + err.message);
  }
}

/* limpar hist√≥rico */
clearHistBtn.addEventListener('click', ()=>{
  if(!confirm('Limpar hist√≥rico?')) return;
  history = [];
  renderHistory();
});

/* limpar totais */
document.querySelectorAll('[data-clear]').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const type = btn.getAttribute('data-clear');
    if(confirm('Limpar total de ' + type + '?')){
      if(type === 'din') totals.din = 0;
      if(type === 'cred') totals.cred = 0;
      if(type === 'deb') totals.deb = 0;
      updateTotalsUI();
    }
  });
});

/* bot√µes F5/F6/F7 na UI (clic√°veis) */
btnF5.addEventListener('click', ()=> selectType('din'));
btnF6.addEventListener('click', ()=> selectType('cred'));
btnF7.addEventListener('click', ()=> selectType('deb'));

/* checkboxes tamb√©m selecionam (como alternativa) */
chkDin.addEventListener('change', ()=> selectType(chkDin.checked ? 'din' : null));
chkCred.addEventListener('change', ()=> selectType(chkCred.checked ? 'cred' : null));
chkDeb.addEventListener('change', ()=> selectType(chkDeb.checked ? 'deb' : null));

function selectType(t){
  // alterna: se j√° selecionado, desmarca
  if(selected === t){ selected = null; }
  else selected = t;
  updateTotalsUI();
}

/* REMO√á√ÉO: Eventos do keypad virtual foram removidos. */

/* bot√µes add / calc */
document.getElementById('btnAdd').addEventListener('click', addToSelected);
document.getElementById('btnCalc').addEventListener('click', calcOnly);

/* teclado f√≠sico */
document.addEventListener('keydown', (e)=>{
  const allowed = '0123456789+-*/().,%';
  // prevenir F5 padr√£o (refresh) etc.
  if(['F5','F6','F7'].includes(e.key)){
    e.preventDefault();
    if(e.key === 'F5') selectType('din');
    if(e.key === 'F6') selectType('cred');
    if(e.key === 'F7') selectType('deb');
    return;
  }

  if(e.key === 'Enter'){
    e.preventDefault();
    addToSelected();
    return;
  }
  if(e.key === 'Escape'){
    entrada.value = '';
    return;
  }
  if(e.key === 'Backspace'){
    // permite apagar no campo
    if(document.activeElement !== entrada){
      entrada.focus();
    }
    // default backspace will do the job when input focused; let it
    return;
  }

  // Aceita v√≠rgula como decimal (do teclado principal ou numpad)
  if(e.key === ',' || e.key === '.'){ 
    if(document.activeElement !== entrada) {
      entrada.value += ','; 
      e.preventDefault(); 
      return; 
    }
    // Se estiver focado no input, deixa o input lidar com o evento
    return;
  }

  // se tecla v√°lida, inserir no campo (quando n√£o estiver digitando em outro input)
  if(allowed.includes(e.key) && document.activeElement !== entrada){
    // Permite que teclas de c√°lculo sejam digitadas mesmo sem o foco estar na entrada, para agilizar.
    entrada.value += e.key;
    e.preventDefault();
    return;
  }
});

/* inicializa√ß√£o */
renderHistory();
updateTotalsUI();

/* foco inicial */
entrada.focus();

/* dica: ao colar texto, normalizar v√≠rgula */
entrada.addEventListener('paste', (ev)=>{
  ev.preventDefault();
  const text = (ev.clipboardData || window.clipboardData).getData('text');
  // Substitui ponto por v√≠rgula e remove espa√ßos ao colar
  entrada.value += text.replace(/\s+/g,'').replace(/\./g,',');
});
</script>
</body>
</html>
